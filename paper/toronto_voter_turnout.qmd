---
title: "The Impact of Socio-Economic and Demographic Factors on Voter Turnout in Toronto Wards"
subtitle: "An Analysis of the 2022 Toronto Municipal Election"
author: 
  - Janel Gilani
thanks: "Code and data are available at: https://github.com/JanelGilani/toronto-voter-turnout"
date: today
date-format: long
abstract: "First sentence. Second sentence. Third sentence. Fourth sentence."
format: pdf
toc: true
number-sections: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false

#install.packages("tinytex")
#install.packages("tidyverse")
#install.packages("knitr")
#install.packages("kableExtra")
#install.packages("here")
#install.packages("ggbeeswarm")

#tinytex::install_tinytex()

#install.packages("rstanarm")
#install.packages("arrow")
#install.packages("tidybayes")
#install.packages("modelsummary")
#install.packages("broom.mixed")
#install.packages("parameters")
#install.packages("sf")
#install.packages("ggrepel")
#install.packages("ggplot2")
#install.packages("dplyr")
#install.packages("patchwork")


library(tidyverse) # a collection of data-related packages
library(knitr) # for kable
library(kableExtra)
library(here)
library(ggbeeswarm)
library(dplyr)
library(ggplot2)
library(sf)
library(ggrepel)
library(patchwork)
library(rstanarm)
library(arrow)
library(modelsummary)
library(broom.mixed)
library(parameters)


analysis_data <- read_csv(file = here::here("data/analysis_data/analysis_data.csv"))
election_data <- read_csv(file = here::here("data/analysis_data/cleaned_election_data.csv"))
ward_data <- read_csv(file = here::here("data/analysis_data/cleaned_ward_data.csv"))

```

# Introduction

Voting for the mayor of your ward is one of the most important decisions a Canadian citizen can make because it decides many of the decisions that will be made throughout that four year term as well as how their life will change in that period of time. This is why it is important to understand the many factors that influence the voter turnout and thus, ultimately affect the integrity and representativeness of the electoral process. As mandated by the Government of Ontario, residents of the City of Toronto went to the polls on October 24, 2022 to elect a mayor, councillors, and school board trustees. Then-sitting Mayor, John Tory, sought re-election, along with a number of incumbent city councillors. Coming out of the height of the COVID-19 pandemic, the 2022 election largely upheld the status quo and did not feature ambitious policy platforms. Voter turnout across the city fell to 30% - the lowest in the city’s history since amalgamation in 1997, with turnout ranging on a ward-by-ward basis from 22% to 38% [@election2022; @torontoTurnout]. 

While there is existing literature on most of these factors in isolation, there has been little research that has examined the combined effect of these explanatory factors on voter turnout, especially in Canadian cities like Toronto and this paper will contribute to the investigation of this phenomenon. Using the 2022 Toronto Municipal Election and Ward Profiles data from Open Data Toronto, this paper will be examining many factors that could have influenced voter turnout in the 2022 Toronto Municipal Election such as education, income, unemployment rate, population, and number of subdivisions within a ward. Our main focus is to conduct analysis on voter turnout as the response variable, and to see if our estimand, the effect of ward's socio-economic and demographic factors on the ward's voter turnout, has influenced voter turnout in the elections. We found that socio-economic factors such as income, unemployment rate, and education level have a significant impact on voter turnout, while demographic factors such as population and number of subdivisions have a less significant impact. Using these understandings, we hope to highlight the potential implications these correlations may have on upcoming elections and the electoral process in Toronto.

Our paper begins with the Data section (@sec-data) to visualize and further understand the measurement, source, methodology, and variables we are examining. Then, we introduce the Model (@sec-model) used to understand the relationships in the data and report the findings in the Results section (@sec-results). Finally, we include the Discussion (@sec-discussion) of the findings, summarizing the takeaway and future of this research.



# Data {#sec-data}

Data analysis is performed in `R` [@citeR], and additional help is provided by libraries such as `dplyr` [@dplyr], `ggplot2` [@ggplot], `ggrepel` [@ggrepel], `tidyverse` [@thereferencecanbewhatever], `kableExtra` [@kableextra], `knitr` [@knitr], and `sf` [@pebesma2023spatial], `opendatatoronto` [@toronto], `readxl` [@excel], `here` [@here], `rstanarm` [@rstan], `arrow` [@arrow], `tidybayes` [@tidybayes], `modelsummary` [@modelsummary], `broom` [@broom], and `parameters` [@parameters]. 
Data for this research comes from Open Data Toronto [@toronto], an open source data portal containing various topics of data for the city. 
For the data involved in this paper, we combine `Elections - Voter Statistics` [@PublicArt] and `Ward Profiles (25-Ward Model)` [@WardProfile]
 

## Measurement 

Our research question and estimand is divided into two parts: impact of socio-economic factors and demographic factors on voter turnout, which is our response variable.
Starting off with socio-economic factors, we use education, income, and unemployment rate as the explanatory variables to represent these factors. Education is a key factor in determining voter turnout as it is associated with political knowledge, interest, and participation [@Verba]. To measure education, we use the percentage of citizens with no certificate, diploma, or degree as an indicator of education level. Income and unemployment are also important factor in determining voter turnout as they are associated with financial security, political interest, and participation. Household income is not the sole indicator of wealth, but it is heavily related to wealth as both income and wealth are key indicators of financial security [@Schaeffer]. We use the unemployment rate as an indicator of economic stability.

Moving on to demographic factors, we use population and number of subdivisions as the explanatory variables to represent these factors. Individual turnout by ward depended on a number of factors, including the accessibility of polling locations within subdivisions to cast a ballot. The City of Toronto @ElectionDictionary defines a ward as “a geographical area represented by a member of Council.” Subdivisions are defined by the City of Toronto [@VoterStatistics] as “.... geographical area[s within a ward] designated by the City Clerk.” Previous studies concentrating on large cities in the United States, including Atlanta revealed that having polling locations in close proximity to a voter’s home bolsters turnout and even minor changes in placement of a polling location can have significant impact on a voter’s decision to cast a ballot [@Locationx3]. Thus, we use the number of subdivisions as an indicator of accessibility to polling locations. Lastly, we use population as an indicator of the demographic size of the ward.

Election data is formed by collecting the relevant numbers observed during the 2022 Toronto Municipal Election, and ward profiles data is extracted from the 2022 Census data.

## Election Voter Statistics
This dataset, published by the City Clerk's Office [@VoterStatistics] outlines voter statistics on a ward-by-ward and entire city basis for the 2022 municipal election. For each subdivision within a ward, the data set shows the polling location name and address, number of additions and corrections to the voter's list, number of eligible electors and number who voted, and rejected and declined ballots. This data set was last refreshed on February 7, 2023. 

Upon analysis, columns such as rejected and declined ballots were deemed beyond the scope of this paper. We conducted the first step of basic data cleaning to eliminate additional columns and simplify the names of retained columns (see @tbl-cleaned_voter_statistics).


```{r}
#| echo: false
#| message: false
#| label: tbl-election-data
#| tbl-cap: Sample of Cleaned Elections Data
#| tbl-pos: "h"

#referenced kable stying from https://github.com/christina-wei/INF3104-1-Covid-Clinics/blob/main/outputs/paper/covid_clinics.qmd
head(election_data, 5) |>
  kable(
    col.names = c("Ward ID", "Eligible Voter Turnout (%)", "Number of Voters", "Number of Subdivisions"),
    booktabs = TRUE,
    align = "c"
  )

```


## Ward Profiles, 2018 (25-Ward Model)

Ward profiles such as income and population would be interesting factors to analyze alongside eligible voter turnouts. Therefore, the dataset for ward profiles [@torontoWardProfiles] based on 2022 census data has been included in analysis as well. This dataset is published by City Planning, and was last updated on January 3, 2024. The 25-ward model was chosen over the 47-ward model because it is matching the ward classification in the latest elections data. This dataset contains demographic, social, and economic information for each ward such as population, households, families, education, ethnocultural composition, spoken languages, income and housing costs. For our purpose of research, we are interested in population, number of citizens with no certificate, diploma, or degree, unemployment rate, and average household income of each ward. A sample of the cleaned dataset for the wards is shown below in @tbl-cleaned_ward. 

Ward profile data is stored in an Excel file with multiple tabs. The relevant data to be used for this paper's analysis is included the first tab, `2022 Census One Variable`. As such, only data for this tab was downloaded for analysis. Further data cleaning was performed to transpose the data and only keeping information relevant to our research question (see @tbl-cleaned_ward_profile_data).

```{r}
#| echo: false
#| message: false
#| label: tbl-ward-profile-data
#| tbl-cap: Sample of Cleaned Toronto Ward Profile Data
#| tbl-pos: "h"

head(ward_data, 5) |>
  kable(
    col.names = c("Ward ID", "Population", "Uneducated Population (%)", "Unemployment Rate (%)", "Income"),
    booktabs = TRUE,
    align = "c"
  )
```

## Voter Turnout and Ward's Socio-Economic and Demographic Factors

As the goal of this research is to analyze the impact of socio-economic and demographic factors on voter turnout in the 2022 Toronto Municipal Election, we have combined the cleaned election data and ward profile data to create an analysis dataset. The analysis dataset includes the following variables: ward ID, ward name, population, number of subdivisions, percent of uneducated population, unemployment rate, income, voter turnout percentage, and number of voters. Below in @tbl-analysis-data is a sample of the analysis data. 



```{r}
#| echo: false
#| message: false
#| label: tbl-analysis-data
#| tbl-cap: Sample of Combined Ward Election, Income, Employment, and Education Data
#| tbl-pos: "h"

head(analysis_data, 10) |>
  arrange (ward_id) |>
  relocate(c("ward_id", "ward_name",  "population", "num_sub", "percent_uneducated", "unemployment_rate", "income", "percent_voted", "number_voted")) |>
  slice(1:5) |>
  kable(
    booktabs = TRUE,
    col.names = c("Ward ID", "Name",  "Pop.","Num. of SubDiv", "Uneducated Pop. (%)", "Unemployment Rate (%)", "Income", "Voter Turnout (%)", "Num. of Voters"),
    align = c("c", "l", "c", "c", "c", "c", "c", "c", "c")
        ) 
```

```{r}
#| message: false
#| echo: false
#| label: fig-ward-turnout
#| fig-cap: Voter Turnout (%) across Toronto Wards


analysis_data %>%
  ggplot(mapping = aes(x = factor(ward_id), y = percent_voted)) +
  geom_bar(stat = "identity", fill = "gray", color = "black") +
  labs(
    title = "Eligible Voter Turnout (%) across Toronto Wards",
    x = "Ward ID",
    y = "Eligible Voter Turnout (%)"
  ) +
  theme_minimal()
        
```

```{r}
#| tbl-cap: "Summary Statistics"
#| label: tbl-summ-stats
#| echo: false

summary <- analysis_data |>
  summarise(
    Mean_Turnout = mean(percent_voted, na.rm = TRUE),
    Median_Turnout = median(percent_voted, na.rm = TRUE),
    SD_Turnout = sd(percent_voted, na.rm = TRUE),
    Min_Turnout = min(percent_voted, na.rm = TRUE),
    Max_Turnout = max(percent_voted, na.rm = TRUE),
    Mean_Uneducated = mean(percent_uneducated, na.rm = TRUE),
    Median_Uneducated = median(percent_uneducated, na.rm = TRUE),
    SD_Uneducated = sd(percent_uneducated, na.rm = TRUE),
    Min_Uneducated = min(percent_uneducated, na.rm = TRUE),
    Max_Uneducated = max(percent_uneducated, na.rm = TRUE),
    Mean_Unemployment = mean(unemployment_rate, na.rm = TRUE),
    Median_Unemployment = median(unemployment_rate, na.rm = TRUE),
    SD_Unemployment = sd(unemployment_rate, na.rm = TRUE),
    Min_Unemployment = min(unemployment_rate, na.rm = TRUE),
    Max_Unemployment = max(unemployment_rate, na.rm = TRUE),
    Mean_Income = mean(income, na.rm = TRUE),
    Median_Income = median(income, na.rm = TRUE),
    SD_Income = sd(income, na.rm = TRUE),
    Min_Income = min(income, na.rm = TRUE),
    Max_Income = max(income, na.rm = TRUE),
    Mean_Population = mean(population, na.rm = TRUE),
    Median_Population = median(population, na.rm = TRUE),
    SD_Population = sd(population, na.rm = TRUE),
    Min_Population = min(population, na.rm = TRUE),
    Max_Population = max(population, na.rm = TRUE),
    Mean_NumSub = mean(num_sub, na.rm = TRUE),
    Median_NumSub = median(num_sub, na.rm = TRUE),
    SD_NumSub = sd(num_sub, na.rm = TRUE),
    Min_NumSub = min(num_sub, na.rm = TRUE),
    Max_NumSub = max(num_sub, na.rm = TRUE),
    Mean_NumVoters = mean(number_voted, na.rm = TRUE),
    Median_NumVoters = median(number_voted, na.rm = TRUE),
    SD_NumVoters = sd(number_voted, na.rm = TRUE),
    Min_NumVoters = min(number_voted, na.rm = TRUE),
    Max_NumVoters = max(number_voted, na.rm = TRUE)
  )
long_summary_stats <-  summary |>
  pivot_longer(cols = everything(), names_to = "Statistic", values_to = "Value") |>
  separate(Statistic, into = c("Measure", "Variable"), sep = "_") |>
  spread(key = Measure, value = Value) |>
  select(Variable, Mean, Median, SD, Min, Max)

long_summary_stats$Variable <- c("Income", "Number of Subdivisions", "Number of Voters", "Population", "Voter Turnout (%)", "Uneducated Population (%)", "Unemployment Rate (%)")


kable(long_summary_stats,
      format = "markdown",
      digits = 2,
      col.names = c("Variable", "Mean", "Median", "Std. Dev", "Min", "Max"),
      row.names = FALSE,
      align = c('l', 'c', 'c', 'c', 'c', 'c'), 
      ) %>%
  kable_styling(latex_options = "hold_position")


```


```{r}
#| echo: false
#| message: false
#| warning: false
#| label: fig-toronto-map
#| fig-cap: "Map of Toronto highlighting the voter turnout across wards"
#| fig.pos: 'H'

# URL to the zip file
url <- "https://ckan0.cf.opendata.inter.prod-toronto.ca/dataset/5e7a8234-f805-43ac-820f-03d7c360b588/resource/35f67d86-cfc8-4483-8d77-50d035b010d9/download/25-ward-model-december-2018-wgs84-latitude-longitude.zip"

# Temporary file to store the downloaded zip
temp_zip <- tempfile(fileext = ".zip")

# Download the zip file
download.file(url, temp_zip, mode = "wb")

# Unzip the file to a temporary directory
temp_dir <- tempdir()
unzip(temp_zip, exdir = temp_dir)

# Assuming the shapefile is directly in the unzipped folder and has a standard .shp extension
shapefiles <- list.files(temp_dir, pattern = "\\.shp$", full.names = TRUE)

# Read the shapefile (replace 'shapefiles[1]' with the specific file if there are multiple shapefiles)
toronto_map <- st_read(shapefiles[1], quiet = TRUE)

# Clean up the downloaded zip file
unlink(temp_zip)

# Merge analysis_data with toronto_map by ward_id
toronto_map <- merge(toronto_map, analysis_data, by.x = "AREA_S_CD", by.y = "ward_id")

color_scale <- scale_fill_gradient(low = "lightblue", high = "darkblue", limits = c(22, 38))

# Plot the map
ggplot() +
  geom_sf(data = toronto_map, aes(fill = percent_voted)) +
  color_scale +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```



```{r}
#| echo: false
#| label: turnout_vs_income
#| fig-cap: "Correlation between Eligibile Voter Turnout and Ward's Income"
#| warning: false 
  ggplot(data = analysis_data, aes(x = income, y = percent_voted, label = ward_id)) +
  geom_point() +
  geom_text_repel(hjust=-0.5, vjust=0.5) +
  geom_smooth(method = "lm", color = "blue", se = TRUE) +
  theme_minimal() +
  labs(x = "Income", y = "Eligible Voter Turnout (%)") +
  scale_colour_viridis_d()

```

```{r}
#| echo: false
#| label: turnout_vs_unemployment
#| fig-cap: "Correlation between Eligibile Voter Turnout and Ward's Unemployment Rate"
#| warning: false 
  ggplot(data = analysis_data, aes(x = unemployment_rate, y = percent_voted, label = ward_id)) +
  geom_point() +
  geom_text_repel(hjust=-0.5, vjust=0.5) +
  geom_smooth(method = "lm", color = "blue", se = TRUE) +
  theme_minimal() +
  labs(x = "Unemployment Rate (%)", y = "Eligible Voter Turnout (%)") +
  scale_colour_viridis_d()

```

```{r}
#| echo: false
#| label: turnout_vs_education
#| fig-cap: "Correlation between Eligibile Voter Turnout and Ward's Level of Education"
#| warning: false 
  ggplot(data = analysis_data, aes(x = percent_uneducated, y = percent_voted, label = ward_id)) +
  geom_point() +
  geom_text_repel(hjust=-0.5, vjust=0.5) +
  geom_smooth(method = "lm", color = "blue", se = TRUE) +
  theme_minimal() +
  labs(x = "Uneducated Population (%)", y = "Eligible Voter Turnout (%)") +
  scale_colour_viridis_d()

```

```{r}
#| echo: false
#| label: turnout_vs_population
#| fig-cap: "Correlation between Eligibile Voter Turnout and Ward's Population"
#| warning: false 
  ggplot(data = analysis_data, aes(x = population, y = percent_voted, label = ward_id)) +
  geom_point() +
  geom_text_repel(hjust=-0.5, vjust=0.5) +
  geom_smooth(method = "lm", color = "red", se = TRUE) +
  theme_minimal() +
  labs(x = "Population", y = "Eligible Voter Turnout (%)") +
  scale_colour_viridis_d()

```

```{r}
#| echo: false
#| label: turnout_vs_numsub
#| fig-cap: "Correlation between Eligibile Voter Turnout and Ward's Number of Subdivisions"
#| warning: false 
  ggplot(data = analysis_data, aes(x = num_sub, y = percent_voted, label = ward_id)) +
  geom_point() +
  geom_text_repel(hjust=-0.5, vjust=0.5) +
  geom_smooth(method = "lm", color = "red", se = TRUE) +
  theme_minimal() +
  labs(x = "Number of Subdivisions", y = "Eligible Voter Turnout (%)") +
  scale_colour_viridis_d()

```

# Model {#sec-model}

The goal of our modelling strategy is twofold. Firstly,...

Here we briefly describe the Bayesian analysis model used to investigate... Background details and diagnostics are included in [Appendix -@sec-model-details].

## Model set-up

Define $y_i$ as the number of seconds that the plane remained aloft. Then $\beta_i$ is the wing width and $\gamma_i$ is the wing length, both measured in millimeters.  

\begin{align} 
y_i|\mu_i, \sigma &\sim \mbox{Normal}(\mu_i, \sigma) \\
\mu_i &= \alpha + \beta_i + \gamma_i\\
\alpha &\sim \mbox{Normal}(0, 2.5) \\
\beta &\sim \mbox{Normal}(0, 2.5) \\
\gamma &\sim \mbox{Normal}(0, 2.5) \\
\sigma &\sim \mbox{Exponential}(1)
\end{align}

We run the model in R [@citeR] using the `rstanarm` package of @rstanarm. We use the default priors from `rstanarm`.


### Model justification

We expect a positive relationship between the size of the wings and time spent aloft. In particular...

We can use maths by including latex between dollar signs, for instance $\theta$.


# Results {#sec-results}

Our results are summarized in @tbl-modelresults.

```{r}
#| echo: false
#| eval: true
#| warning: false
#| message: false

socioeconomic_gaussian_model <-
  readRDS(file = here::here("models/socioeconomic_gaussian_model.rds"))

socioeconomic_poisson_model <-
  readRDS(file = here::here("models/socioeconomic_poisson_model.rds"))

socioeconomic_negative_binomial_model <-
  readRDS(file = here::here("models/socioeconomic_negative_binomial_model.rds"))

demographic_gaussian_model <-
  readRDS(file = here::here("models/demographic_gaussian_model.rds"))

demographic_poisson_model <-
  readRDS(file = here::here("models/demographic_poisson_model.rds"))

demographic_negative_binomial_model <-
  readRDS(file = here::here("models/demographic_negative_binomial_model.rds"))

```

```{r}
#| echo: false
#| eval: true
#| label: tbl-SEmodelresults
#| tbl-cap: "Socio-economic explanatory models of voter turnout based on education, employment and income"
#| warning: false

  modelsummary(
  list(
  "Multiple Linear Regression" = socioeconomic_gaussian_model,
  "Poisson Regression" = socioeconomic_poisson_model),
  statistic = 'conf.int',
  conf.level = 0.99,
  fmt = 2)


```



```{r}
#| echo: false
#| eval: true
#| label: tbl-Dmodelresults
#| tbl-cap: "Demographic explanatory models of voter turnout based on population and number of subdivisions"
#| warning: false

models <- list(
  "Multiple Linear Regression" = demographic_gaussian_model,
  "Poisson Regression" = demographic_poisson_model)

modelsummary(models,
             statistic = 'conf.int', conf_level = 0.99, fmt = 2)

```

# Discussion {#sec-discussion}

## First discussion point {#sec-first-point}

If my paper were 10 pages, then should be be at least 2.5 pages. The discussion is a chance to show off what you know and what you learnt from all this. 

## Second discussion point

## Third discussion point

## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage

\appendix

# Appendix {-}


# Additional data details

# Model details {#sec-model-details}

## Posterior predictive check

In @fig-ppcheckandposteriorvsprior-1 we implement a posterior predictive check. This shows...

In @fig-ppcheckandposteriorvsprior-2 we compare the posterior with the prior. This shows... 

```{r}
#| eval: true
#| echo: false
#| message: false
#| warning: false
#| label: fig-ppcheckandposteriorvsprior
#| layout-ncol: 2
#| fig-cap: "Examining how the model fits, and is affected by, the data"
#| fig-subcap: ["Posterior prediction check", "Comparing the posterior with the prior"]


analysis_data <- analysis_data %>%
  mutate(income = income / 1000)

# Round percent_voted to the nearest integer for Poisson and Negative Binomial models
rounded_analysis_data <- analysis_data %>%
  mutate(percent_voted = as.integer(round(percent_voted)))

pp_check(socioeconomic_gaussian_model) +
  theme_classic() +
  theme(legend.position = "bottom")

posterior_vs_prior(socioeconomic_gaussian_model) +
  theme_minimal() +
  scale_color_brewer(palette = "Set1") +
  theme(legend.position = "bottom") +
  coord_flip()
```

## Diagnostics

@fig-stanareyouokay-1 is a trace plot. It shows... This suggests...

@fig-stanareyouokay-2 is a Rhat plot. It shows... This suggests...

```{r}
#| echo: false
#| eval: true
#| message: false
#| warning: false
#| label: fig-stanareyouokay
#| fig-cap: "Checking the convergence of the MCMC algorithm"
#| fig-subcap: ["Trace plot", "Rhat plot"]
#| layout-ncol: 2

plot(socioeconomic_gaussian_model, "trace")

plot(socioeconomic_gaussian_model, "rhat")
```



\newpage


# References


